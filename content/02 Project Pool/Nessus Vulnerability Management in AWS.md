# Overview
We will create a test network of EC2 instances and install Tenable Nessus in order to scan the network for any vulnerabilities. We will later create a Terraform script to automate the creation of the lab for easy access. 

# Prerequisites
For this project, we will using AWS as our cloud provider while using terraform to create the instances. High level knowledge of cloud, networking, as well as Terraform is required. 

# Setup

## Create the 2019 Windows instance
In the AWS console, navigate to EC2 and select 'Launch instances':

![[Pasted image 20250107062206.png]]

We will be using Windows Server 2019 and the t2.micro instance type:

![[Pasted image 20250107063215.png]]

Create a new .pem key pair and give it a name. Save it as we will need it later.

For network settings, we will allow RDP traffic from anywhere to simplify the lab. You may want to restrict it to only your IP in your case. We will also allow HTTP and HTTPS traffic:

![[Pasted image 20250107063539.png]]

Leave all other options as is and select 'Launch instance':

![[Pasted image 20250107063704.png]]

We can now see that the instance has been created and running:

![[Pasted image 20250107063817.png]]

## Connect to the Windows instance
Now that the instance is running, Click on the 'Connect' button:

![[Pasted image 20250107064031.png]]

Select 'Get password':

![[Pasted image 20250107064242.png]]

Upload the .pem key we created during the creation of the instance in order to decrypt the password:

![[Pasted image 20250107064428.png]]

After decrypting the password, save it as we will need it to login to the instance:

>[!warning] Warning:
>I am displaying the key as well as the password for demonstration purposes. You should not expose your secrets in production like this!

![[Pasted image 20250107064646.png]]

Now that we have the Administrator password, we can download the RDP file and enter the credentials:

![[Pasted image 20250107071126.png]]

After clicking on the RDP file, select 'Connect':

![[Pasted image 20250107071151.png]]

Enter the password you copied earlier:

![[Pasted image 20250107071516.png]]

Select 'Yes':

![[Pasted image 20250107071257.png]]

We are now in the instance:

![[Pasted image 20250107071711.png]]

## Increase Storage for the Instance
It is crucial to increase storage if you would like to successfully install Nessus. Check the footnote [^1] for more information.

### Increase from AWS Console
In the EC2 instance storage tab, click on the Volume ID:

![[Pasted image 20250107143414.png]]

Select 'Modify':

![[Pasted image 20250107143500.png]]

Increase the volume size to your preferred (GiB) and select 'Modify'. For this demonstration, I increased it from 30 (GiB) to 60 (GiB):

![[Pasted image 20250107143546.png]]

### Extend Disk in Windows

Go back into the Windows instance and open Disk Management:

![[Pasted image 20250107144352.png]]

You should see a newly unallocated partition. Right click on Disk 0 and select 'Extend':

![[Pasted image 20250107144535.png]]

You now have enough storage to install the needed applications.
## Install Firefox
In order to download Nessus, we will need to install a web browser that is compatible with modern websites.

Open PowerShell and run:

```
Invoke-WebRequest -Uri 'https://download.mozilla.org/?product=firefox-latest&os=win64&lang=en-US' -OutFile 'C:\firefox.exe' ; Start-Process 'C:\firefox.exe' /S
```

This will install Firefox on the instance:

![[Pasted image 20250107075811.png]]

Now that we have a modern browser, we can proceed to the next step.
## Install Tenable Nessus in the Windows instance
In the Windows Instance, navigate to the Nessus download site and run the .exe file: 

```
https://www.tenable.com/downloads/nessus?loginAttempted=true
```

![[Pasted image 20250107080016.png]]

Select 'Ok':

![[Pasted image 20250107080218.png]]

Go through the install wizard and agree to the terms and conditions:

![[Pasted image 20250107080318.png]]

Once the wizard is finished, in Firefox, go to https://localhost:8834. Accept the risk and continue:

![[Pasted image 20250107080846.png]]

Tenable Nessus welcome page will pop up:

![[Pasted image 20250107081631.png]]

Register for the Nessus Essentials:
![[Pasted image 20250107082201.png]]

Activate the license you received in your email:

![[Pasted image 20250107081938.png]]

Create a username and password:

![[Pasted image 20250107082335.png]]

Allow for Nessus to download all the necessary items:

![[Pasted image 20250107082504.png]]

Once we are in the portal, we have successfully installed Nessus:

![[Pasted image 20250107104003.png]]

>[!Note:]
>It will take a while for Nessus to download and compile all the necessary plugins.

![[Pasted image 20250107143238.png]]
## Create Target Machines
Now that we have Nessus ready, we need to create a couple instances so Nessus can scan the network.

Create 2 instances with the same security group and VPC as the Nessus instance:

![[Pasted image 20250107103425.png]]

## Edit Security Group
In order to connect to the Linux based instances, add port 22 to allow SSH. 

# Network Scanning
Select 'New Folder' and give it a name:

![[Pasted image 20250107161757.png]]

Select 'Create a new scan':

![[Pasted image 20250107161955.png]]
## Basic Network Scanning
Select 'Basic Network Scan':

![[Pasted image 20250107201429.png]]

Give the scan a name as well as the targets. Paste the private IP addresses of the two target instances we created. Select 'Launch':

![[Pasted image 20250107201754.png]]

The scan will take a while but once it is done we can see the results:

![[Pasted image 20250107201942.png]]

Since these are stock AMIs, there are not that many vulnerabilities found on the target machines.  
# Findings

# Remediation

# Automating the Lab

# Conclusion

# Footnotes

[^1]: I found a couple issues with the Windows instance during the Nessus install was due to the lack of storage on the free tier. Went back and added the increase storage portion to prevent any problems for anyone doing a follow along. 
